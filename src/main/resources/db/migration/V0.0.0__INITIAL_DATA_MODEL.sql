CREATE TABLE USERS
(
    ID            INTEGER GENERATED BY DEFAULT AS IDENTITY,
    USERNAME      VARCHAR(50)  NOT NULL,
    ROLE          VARCHAR(50)  NOT NULL,
    PASSWORD_HASH VARCHAR(100) NOT NULL,
    CREATED       TIMESTAMP(6) NOT NULL,
    MODIFIED      TIMESTAMP(6),
    CONSTRAINT USERS_PK PRIMARY KEY (ID),
    CONSTRAINT USERS_USERNAME_UC UNIQUE (USERNAME)
);

CREATE TABLE ORGANIZATIONS
(
    ID          INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME        VARCHAR(50)  NOT NULL,
    DESCRIPTION VARCHAR(4000),
    CREATED     TIMESTAMP(6) NOT NULL,
    MODIFIED    TIMESTAMP(6),
    CONSTRAINT ORGANIZATIONS_PK PRIMARY KEY (ID),
    CONSTRAINT ORGANIZATIONS_NAME_UC UNIQUE (NAME)
);

CREATE TABLE MEMBERS
(
    ID              INTEGER GENERATED BY DEFAULT AS IDENTITY,
    ORGANIZATION_ID INTEGER     NOT NULL,
    USER_ID         INTEGER     NOT NULL,
    ROLE            VARCHAR(50) NOT NULL,
    CONSTRAINT ORGANIZATION_ID_USER_ID_UC UNIQUE (ORGANIZATION_ID, USER_ID),
    CONSTRAINT MEMBERS_PK PRIMARY KEY (ID)
);

CREATE TABLE BOXES
(
    ID              INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME            VARCHAR(50)  NOT NULL,
    DESCRIPTION     VARCHAR(4000),
    PRIVATE         BOOLEAN      NOT NULL,
    DOWNLOADS       INTEGER      NOT NULL,
    ORGANIZATION_ID INTEGER      NOT NULL,
    CREATED         TIMESTAMP(6) NOT NULL,
    MODIFIED        TIMESTAMP(6),
    CONSTRAINT BOXES_PK PRIMARY KEY (ID),
    CONSTRAINT BOXES_NAME_ORGANIZATION_ID_UC UNIQUE (NAME, ORGANIZATION_ID),
    CONSTRAINT ORGANIZATION_ID_FK FOREIGN KEY (ORGANIZATION_ID) REFERENCES ORGANIZATIONS (ID)
);

CREATE TABLE VERSIONS
(
    ID          INTEGER GENERATED BY DEFAULT AS IDENTITY,
    VERSION     VARCHAR(10)  NOT NULL,
    DESCRIPTION VARCHAR(4000),
    STATUS      VARCHAR(10)  NOT NULL,
    BOX_ID      INTEGER      NOT NULL,
    CREATED     TIMESTAMP(6) NOT NULL,
    MODIFIED    TIMESTAMP(6),
    CONSTRAINT VERSIONS_PK PRIMARY KEY (ID),
    CONSTRAINT VERSIONS_NAME_BOX_ID_UC UNIQUE (VERSION, BOX_ID),
    CONSTRAINT BOX_ID_FK FOREIGN KEY (BOX_ID) REFERENCES BOXES (ID)
);

CREATE TABLE PROVIDERS
(
    ID            INTEGER GENERATED BY DEFAULT AS IDENTITY,
    NAME          VARCHAR(50)  NOT NULL,
    CHECKSUM      VARCHAR(200) NOT NULL,
    CHECKSUM_TYPE VARCHAR(10)  NOT NULL,
    HOSTED        BOOLEAN      NOT NULL,
    HOSTED_TOKEN  VARCHAR(200),
    STATUS        VARCHAR(10)  NOT NULL,
    VERSION_ID    INTEGER      NOT NULL,
    CREATED       TIMESTAMP(6) NOT NULL,
    MODIFIED      TIMESTAMP(6),
    CONSTRAINT PROVIDERS_PK PRIMARY KEY (ID),
    CONSTRAINT PROVIDERS_NAME_VERSION_ID_UC UNIQUE (NAME, VERSION_ID),
    CONSTRAINT VERSION_ID_FK FOREIGN KEY (VERSION_ID) REFERENCES VERSIONS (ID)
);

CREATE TABLE UPLOADS
(
    ID            INTEGER GENERATED BY DEFAULT AS IDENTITY,
    UID           VARCHAR(50)  NOT NULL,
    UPLOAD_PATH   VARCHAR(200),
    FILE_SIZE     BIGINT,
    CHECKSUM      VARCHAR(200),
    CHECKSUM_TYPE VARCHAR(10)  NOT NULL,
    STATUS        VARCHAR(10)  NOT NULL,
    PROVIDER_ID   INTEGER      NOT NULL,
    CREATED       TIMESTAMP(6) NOT NULL,
    MODIFIED      TIMESTAMP(6),
    CONSTRAINT UPLOADS_PK PRIMARY KEY (ID),
    CONSTRAINT UPLOADS_NAME_PROVIDER_ID_UC UNIQUE (UID, PROVIDER_ID),
    CONSTRAINT VERSION_ID_FK FOREIGN KEY (PROVIDER_ID) REFERENCES PROVIDERS (ID)
);
